<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ProtoObject Browser Demo</title>
    <style>
        body { 
            font-family: Arial, sans-serif; 
            max-width: 800px; 
            margin: 0 auto; 
            padding: 20px; 
            background-color: #f5f5f5;
        }
        .demo-section { 
            background: white;
            margin: 20px 0;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .result { 
            background-color: #f8f9fa;
            padding: 10px;
            margin: 10px 0;
            border-radius: 4px;
            border-left: 4px solid #007bff;
            font-family: monospace;
            white-space: pre-wrap;
        }
        .error { 
            background-color: #f8d7da;
            color: #721c24;
            border-left-color: #dc3545;
        }
        .success { 
            background-color: #d4edda;
            color: #155724;
            border-left-color: #28a745;
        }
        button {
            background-color: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            margin: 5px;
            border-radius: 4px;
            cursor: pointer;
        }
        button:hover {
            background-color: #0056b3;
        }
        input, textarea {
            width: 100%;
            padding: 8px;
            margin: 5px 0;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
        textarea {
            height: 100px;
            font-family: monospace;
        }
    </style>
</head>
<body>
    <h1>üöÄ ProtoObject Browser Demo</h1>
    <p>This demo shows ProtoObject working directly in the browser without Node.js dependencies.</p>

    <div class="demo-section">
        <h2>üì¶ Environment Check</h2>
        <button onclick="checkEnvironment()">Check Browser Environment</button>
        <div id="env-result" class="result"></div>
    </div>

    <div class="demo-section">
        <h2>üèóÔ∏è Basic ProtoObject Usage</h2>
        <button onclick="testBasicUsage()">Test Basic Object Creation</button>
        <div id="basic-result" class="result"></div>
    </div>

    <div class="demo-section">
        <h2>üìù JSON Serialization</h2>
        <textarea id="json-input" placeholder='{"name": "Test User", "age": 30, "skills": ["JavaScript", "TypeScript"]}'></textarea>
        <button onclick="testJSONSerialization()">Test JSON Serialization</button>
        <div id="json-result" class="result"></div>
    </div>

    <div class="demo-section">
        <h2>üíæ LocalStorage Integration</h2>
        <input id="storage-key" placeholder="storage-key" value="demo-object">
        <input id="storage-data" placeholder='{"message": "Hello Browser!"}'>
        <button onclick="saveToStorage()">Save to LocalStorage</button>
        <button onclick="loadFromStorage()">Load from LocalStorage</button>
        <button onclick="clearStorage()">Clear Storage</button>
        <div id="storage-result" class="result"></div>
    </div>

    <div class="demo-section">
        <h2>üåê Fetch API Integration</h2>
        <input id="api-url" placeholder="API URL" value="https://httpbin.org/post">
        <textarea id="api-data" placeholder='{"message": "Hello from ProtoObject!"}'></textarea>
        <button onclick="testFetchAPI()">Test API Request</button>
        <div id="fetch-result" class="result"></div>
    </div>

    <div class="demo-section">
        <h2>‚ö° Performance Test</h2>
        <input id="perf-iterations" type="number" value="1000" placeholder="Iterations">
        <button onclick="testPerformance()">Run Performance Test</button>
        <div id="perf-result" class="result"></div>
    </div>

    <script type="module">
        // Using browser-compatible version of ProtoObject
        
        // Simple ProtoObject implementation for demo
        class DemoProtoObject {
            constructor(data = {}) {
                Object.assign(this, data);
                return this;
            }
            
            toJSON() {
                const result = {};
                for (const key in this) {
                    if (this.hasOwnProperty(key) && typeof this[key] !== 'function') {
                        result[key] = this[key];
                    }
                }
                return result;
            }
            
            static fromJSON(data) {
                return new this(data);
            }
            
            validate() {
                return Object.keys(this).length > 0;
            }
            
            transform(transformer) {
                const data = this.toJSON();
                return transformer(data);
            }
        }

        // Make classes available globally for demo
        window.DemoProtoObject = DemoProtoObject;
        
        function log(elementId, message, type = 'info') {
            const element = document.getElementById(elementId);
            element.textContent = message;
            element.className = `result ${type}`;
        }

        function logError(elementId, error) {
            log(elementId, `‚ùå Error: ${error.message}`, 'error');
        }

        window.checkEnvironment = function() {
            try {
                const info = {
                    userAgent: navigator.userAgent,
                    platform: navigator.platform,
                    language: navigator.language,
                    cookieEnabled: navigator.cookieEnabled,
                    onLine: navigator.onLine,
                    localStorage: typeof localStorage !== 'undefined',
                    sessionStorage: typeof sessionStorage !== 'undefined',
                    indexedDB: typeof indexedDB !== 'undefined',
                    fetch: typeof fetch !== 'undefined',
                    webSocket: typeof WebSocket !== 'undefined',
                    worker: typeof Worker !== 'undefined',
                    serviceWorker: 'serviceWorker' in navigator,
                    geolocation: 'geolocation' in navigator,
                    timestamp: new Date().toISOString()
                };
                
                log('env-result', `‚úÖ Browser Environment:\n${JSON.stringify(info, null, 2)}`, 'success');
            } catch (error) {
                logError('env-result', error);
            }
        };

        window.testBasicUsage = function() {
            try {
                // Create test object
                const user = new DemoProtoObject({
                    id: 1,
                    name: 'Browser User',
                    email: 'user@browser.demo',
                    preferences: {
                        theme: 'dark',
                        notifications: true
                    },
                    tags: ['demo', 'browser', 'protoobject']
                });

                // Test methods
                const isValid = user.validate();
                const json = user.toJSON();
                const restored = DemoProtoObject.fromJSON(json);
                
                // Test transformation
                const transformed = user.transform(data => ({
                    ...data,
                    displayName: data.name.toUpperCase(),
                    createdAt: new Date().toISOString()
                }));

                const result = {
                    original: user,
                    isValid,
                    serialized: json,
                    restored: restored,
                    transformed: transformed,
                    matches: restored.name === user.name && restored.email === user.email
                };

                log('basic-result', `‚úÖ Basic Usage Test:\n${JSON.stringify(result, null, 2)}`, 'success');
            } catch (error) {
                logError('basic-result', error);
            }
        };

        window.testJSONSerialization = function() {
            try {
                const input = document.getElementById('json-input').value || '{"name": "Test", "value": 42}';
                const data = JSON.parse(input);
                
                const obj = new DemoProtoObject(data);
                const serialized = JSON.stringify(obj.toJSON());
                const parsed = JSON.parse(serialized);
                const restored = DemoProtoObject.fromJSON(parsed);
                
                const result = {
                    input: data,
                    object: obj.toJSON(),
                    serialized: serialized,
                    restored: restored.toJSON(),
                    isEqual: JSON.stringify(data) === JSON.stringify(restored.toJSON())
                };

                log('json-result', `‚úÖ JSON Serialization Test:\n${JSON.stringify(result, null, 2)}`, 'success');
            } catch (error) {
                logError('json-result', error);
            }
        };

        window.saveToStorage = function() {
            try {
                const key = document.getElementById('storage-key').value;
                const dataStr = document.getElementById('storage-data').value || '{"message": "Hello!"}';
                const data = JSON.parse(dataStr);
                
                const obj = new DemoProtoObject(data);
                localStorage.setItem(key, JSON.stringify(obj.toJSON()));
                
                log('storage-result', `‚úÖ Saved to localStorage[${key}]:\n${JSON.stringify(obj.toJSON(), null, 2)}`, 'success');
            } catch (error) {
                logError('storage-result', error);
            }
        };

        window.loadFromStorage = function() {
            try {
                const key = document.getElementById('storage-key').value;
                const stored = localStorage.getItem(key);
                
                if (!stored) {
                    log('storage-result', `‚ö†Ô∏è No data found for key: ${key}`, 'error');
                    return;
                }
                
                const data = JSON.parse(stored);
                const obj = DemoProtoObject.fromJSON(data);
                
                log('storage-result', `‚úÖ Loaded from localStorage[${key}]:\n${JSON.stringify(obj.toJSON(), null, 2)}`, 'success');
            } catch (error) {
                logError('storage-result', error);
            }
        };

        window.clearStorage = function() {
            try {
                const key = document.getElementById('storage-key').value;
                localStorage.removeItem(key);
                log('storage-result', `‚úÖ Cleared localStorage[${key}]`, 'success');
            } catch (error) {
                logError('storage-result', error);
            }
        };

        window.testFetchAPI = async function() {
            try {
                const url = document.getElementById('api-url').value;
                const dataStr = document.getElementById('api-data').value || '{"test": "data"}';
                const data = JSON.parse(dataStr);
                
                const obj = new DemoProtoObject(data);
                
                const response = await fetch(url, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(obj.toJSON())
                });
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
                
                const result = await response.json();
                
                log('fetch-result', `‚úÖ API Request Successful:\n${JSON.stringify(result, null, 2)}`, 'success');
            } catch (error) {
                logError('fetch-result', error);
            }
        };

        window.testPerformance = function() {
            try {
                const iterations = parseInt(document.getElementById('perf-iterations').value) || 1000;
                
                const startTime = performance.now();
                
                for (let i = 0; i < iterations; i++) {
                    const obj = new DemoProtoObject({
                        id: i,
                        name: `Object ${i}`,
                        data: [1, 2, 3, i],
                        nested: { value: i, timestamp: Date.now() }
                    });
                    
                    const json = obj.toJSON();
                    const serialized = JSON.stringify(json);
                    const parsed = JSON.parse(serialized);
                    DemoProtoObject.fromJSON(parsed);
                }
                
                const endTime = performance.now();
                const duration = endTime - startTime;
                const opsPerSecond = Math.round((iterations / duration) * 1000);
                
                const result = {
                    iterations,
                    duration: `${duration.toFixed(2)}ms`,
                    opsPerSecond: `${opsPerSecond} ops/sec`,
                    avgTimePerOp: `${(duration / iterations).toFixed(4)}ms`,
                    memoryUsage: performance.memory ? {
                        used: `${(performance.memory.usedJSHeapSize / 1024 / 1024).toFixed(2)} MB`,
                        total: `${(performance.memory.totalJSHeapSize / 1024 / 1024).toFixed(2)} MB`
                    } : 'Not available'
                };
                
                log('perf-result', `‚úÖ Performance Test Results:\n${JSON.stringify(result, null, 2)}`, 'success');
            } catch (error) {
                logError('perf-result', error);
            }
        };

        // Auto-run environment check
        setTimeout(() => {
            checkEnvironment();
        }, 100);
    </script>
</body>
</html>
